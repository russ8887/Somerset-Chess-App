{% extends "admin/change_list.html" %}
{% load i18n admin_urls static admin_list %}

{% block content_title %}
    <h1>One-Off Events Management</h1>
    <p class="help">Manage special events that affect student attendance. Events are automatically processed when coaches view their dashboards.</p>
{% endblock %}

{% block extrahead %}
    {{ block.super }}
    <style>
        .quick-actions {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .quick-actions h3 {
            margin-top: 0;
            color: #495057;
            font-size: 1.1rem;
        }
        .btn-quick {
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .btn-holiday {
            background-color: #dc3545;
            border-color: #dc3545;
            color: white;
        }
        .btn-pupil-free {
            background-color: #fd7e14;
            border-color: #fd7e14;
            color: white;
        }
        .btn-school-event {
            background-color: #6f42c1;
            border-color: #6f42c1;
            color: white;
        }
        .event-info {
            background: #e7f3ff;
            border-left: 4px solid #007bff;
            padding: 0.75rem;
            margin-bottom: 1rem;
        }
    </style>
{% endblock %}

{% block result_list %}
    <div class="quick-actions">
        <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
        <p>Create common events quickly with pre-filled settings:</p>
        
        <form method="post" style="display: inline;">
            {% csrf_token %}
            <input type="hidden" name="action" value="create_public_holiday">
            <input type="hidden" name="_selected_action" value="">
            <button type="submit" class="btn btn-holiday btn-quick" onclick="return confirm('Create a Public Holiday event for today that will mark all students absent?')">
                <i class="fas fa-calendar-times"></i> Public Holiday (Today)
            </button>
        </form>
        
        <form method="post" style="display: inline;">
            {% csrf_token %}
            <input type="hidden" name="action" value="create_pupil_free_day">
            <input type="hidden" name="_selected_action" value="">
            <button type="submit" class="btn btn-pupil-free btn-quick" onclick="return confirm('Create a Pupil Free Day event for today that will mark all students absent?')">
                <i class="fas fa-school"></i> Pupil Free Day (Today)
            </button>
        </form>
        
        <form method="post" style="display: inline;">
            {% csrf_token %}
            <input type="hidden" name="action" value="create_whole_school_event">
            <input type="hidden" name="_selected_action" value="">
            <button type="submit" class="btn btn-school-event btn-quick" onclick="return confirm('Create a Whole School Event for today that will mark all students absent?')">
                <i class="fas fa-users"></i> Whole School Event (Today)
            </button>
        </form>
        
        <a href="{% url 'admin:scheduler_oneoffentevent_add' %}" class="btn btn-success btn-quick">
            <i class="fas fa-plus"></i> Create Custom Event
        </a>
    </div>

    <div class="event-info">
        <h4><i class="fas fa-info-circle"></i> How One-Off Events Work</h4>
        <ul>
            <li><strong>Automatic Processing:</strong> Events are automatically applied when coaches view their dashboards</li>
            <li><strong>All Day Events:</strong> Leave time slots blank to affect all lessons for the day</li>
            <li><strong>Specific Times:</strong> Select time slots to only affect certain lesson periods</li>
            <li><strong>Target Groups:</strong> Choose school classes and/or individual students to be affected</li>
            <li><strong>Absence Reason:</strong> Students will be marked absent with "CLASS_EVENT" reason</li>
            <li><strong>Fill-in Prevention:</strong> Affected students won't appear in fill-in suggestions</li>
        </ul>
    </div>

    {{ block.super }}
{% endblock %}

{% block pagination %}
    {{ block.super }}
    
    <div style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 0.375rem;">
        <h4><i class="fas fa-calendar-alt"></i> Upcoming Events</h4>
        <p>Events scheduled for the next 7 days will be automatically processed when coaches view their dashboards.</p>
        
        {% if cl.result_list %}
            {% for event in cl.result_list %}
                {% if event.event_date >= today and event.event_date <= next_week %}
                    <div style="margin-bottom: 0.5rem;">
                        <strong>{{ event.event_date|date:"M d, Y" }}:</strong> {{ event.name }}
                        {% if event.school_classes.all %}
                            (affects {{ event.school_classes.all|length }} class{{ event.school_classes.all|length|pluralize:"es" }})
                        {% endif %}
                    </div>
                {% endif %}
            {% endfor %}
        {% else %}
            <p><em>No upcoming events scheduled.</em></p>
        {% endif %}
    </div>
{% endblock %}
